---
layout: post
title:  "问题汇总"
date:   2013-05-10 10:25:00
categories: miscellaneous
---

{{page.title}}

##最新总结
1. 在个人Blog网站上通过首页无法进入具体的文章页面,解决方法:  
	* _config.yml中"baseurl: /"的":"后面能是一个空格而不是一个tab
	* index.html中: href中删除"site.baseurl"部分.
2. [让windows xp开机跳过登陆界面](http://www.cnetnews.com.cn/2008/0409/799482.shtml)  

##编程总结
###Linux下调试总结  
* 在应用程序(如:DemoApp)编译中中加入-g选项;  
* 在环境变量中加入:ulimit -c unlimited,如:  
	+ vi ~/.bashrc
	+ . ~/.bashrc
* gdb DemoApp core.*  
* bt;  

###如何使用Makefile生成Linux下动态库
* 生成libxxx.a  
	Makefile.am(lib_LIBRARIES=libxxx.a libxxx_a_SOURCES=xxx.cpp)
* 生成libxxx.so  
	Makefile.am(bin_PROGRAMS=libxxx.so libxxx_so_SOURCES=xxx.cpp libxxx_so_LDFLAGS= -fPIC -shared)
* 生成libxxx.la  
	configure.in中增加:AC_PROG_LIBTOOL  
	运行libtoolize --copy --force(-f -c)  
	Makefile.am(lib_LTLIBRARIES=libxxx.la libxxx_la_SOURCES=xxx.cpp)

###编译器
* 所使用的lib/dll编译选项(C/C++-->Use run-time library)必须与应用程序的一致,否则错误莫名其妙;  
* 生成事件中，路径中有空格时必须使用引号("")  
* 在可以指定依赖项的编译器中（如vs2008），注意在菜单“生成”—>“配置管理器”中设置其一致性（特别是静态库依赖，因为其修改的话被依赖项一定要手动重新编译才起作用），如在“活动解决方案配置”中指定“MT Debug”,则“项目上下文”中的所有项目都要是“MT Debug”.否则会提示已经定义或未找到某函数。  

###错误处理
* 核心模块(调用第三方API的模块)的信息一律通过异常抛出，这样可以知道错误发生的具体位置;
* 一个函数只应该有一个try/catch块;
* try/catch不要从函数头开始一直到函数尾，要求包含的语句尽可能的少(变量定义就可以不包含，因为构造/析构函数不应该势出异常;
* 错误码应该分类，每类错误最好定义一个起始值，后面的错误码依次在其上+1;
* 可以抛出int类型的异常，以便第三方调用时可以封装成API(因为他们都是通过返回值来确定调用正确与否);  

###软件工程
* 如何权衡字符串是写入资源文件还是配置文件或者是头文件中呢----使用接口类去让客户自己决定；
* 除了业务层使用命名空间外，其他可以不用;
* 命名空间或文件夹的建立应该以包的原则划分;
* 接口与实现的分离ActiveMQ/CMS;
* 有没有必要增加一系列的命名空间，一个项目只有一个还是根据功能而划分多个呢? 有没有必要因为命名空间的不同而新建相应的文件夹(ProcessPath, Interface);
* 如何在Release中打开某些Debug功能(如前条件与后条件，日志信息)，如何确定是否打开的标准。可不可以在运行前启动测试代码和在程序运行出错的时候启动日志文件;

##问题总结
###编程工具总结
* Q: 安装TortoiseGit-1.8.3.0-32bit.msi时提示:无法通过windows installer服务安装此安装程序包。您必须安装带有更新版本windows Installer服务的Windows";  
* A: 更新WindowsXP-KB942288-v3-x86(http://www.microsoft.com/downloads/zh-cn/details.aspx?FamilyID=5a58b56f-60b6-4412-95b9-54d056d6f9f4).  
* Q: 启动gitblit-1.0.0失败；Ｆailed find JAVA;  
* A: 安装jdk-6u20-windows-i586.exe(一定要此版本).  
* Q: gitblit-1.0.0中的版本库无法通过ＵＲＬ访问；  
* A: gitblit.properties文件中本地路径符合必须是'/'而非’\'(即形如: git.repositoriesFolder = C:/Work/DevTool/GitBox).  
* Q: git push在带空格的文件夹(如:Microsoft SDK.git)会失败；  
* A: 删除空格, 如将Microsoft SDK.git改名为MicrosoftSDK.git。  

###VS2008在QT App的链接过程中失败
在包含Q_OBJECT宏的头文件中，会提示链接错误
原因，是在处理Q_OBJECT宏的方式上,Qt其实是在qmake生成的makefile里面调用了Qt\bin\moc.exe，而VS2008不会，所以要做如下配置：
假设对包含Q_OBJECT宏的aa.h文件进行处理,生成一个moc_aa.cpp
1） 点击aa.h右键在属性里面加一个Custom Build Step；
2） 选取所有配置
3） Custom Build Step->General->Command Line里面加上
$(QTDIR)\bin\moc.exe $(InputPath) -o$(InputDir)\moc_$(InputName).cpp
4） Custom Build Step->General->Outputs里面加上moc_$(InputName).cpp
2.2.  Makefile.am生成动态库文件设置
1.	生成libXXX.a: lib_LIBRARIES=libXXX.a libXXX_a_SOURCES=xxx.cpp
2.	生成libXXX.la:
(1)	configure.in中增加: AC_PROG_LIBTOOL
(2)	运行libtoolize --copy --force(-f -c)
(3)	Makefile.am(lib_LTLIBRARIES=libXXX.la libXXX_la_SOURCES=xxx.cpp)
3.	生成libXXX.so: lib_PROGRAMS=libXXX.so libXXX_so_SOURCES=xxx.cpp libXXX_so_LDFLAGS=-fPIC -shared

##库使用
###APR库
####vs6编译须知
1.	下载解压apr,apr-util,apr-iconv到同一工作目录下;
2.	去掉各文件夹中的版本号, 如文件夹名apr-1.4.2改为apr(使用IDE时需要);
3.	使用IDE打开apr-util/aprutil.dsw(可能提示找不到apr-app.dsp,可替换aprutil.dsw中的"apr_app"为"aprapp");
4.	选择"匹创建", build-all(只要build win32的就可以了);
5.	设置好include, lib, bin目录。

####如何使用静态编译编译出来的APR文件
1.	定义宏 APR_DECLARE_STATIC；
2.	连接类库 apr-1.lib kernel32.lib ws2_32.lib RPCRT4.LIB MSWSOCK.LIB ADVAPI32.LIB

###openssl库
####vs6编译须知
#####编译过程
1.	下载OpenSSL：http://www.openssl.org/source/openssl-0.9.8l.tar.gz
2.	安装Perl;
3.	设置VC6环境：运行VCVARS32.BAT, 进入openssl源码目录。
    以下为参照该目录下的文件INSTALL.W32的执行过程：
    运行configure：
    perl Configure VC-WIN32 no-asm
    创建Makefile文件：
    ms\do_ms

    编译动态库：（注意编译问题中的8库函数版本问题）
    nmake -f ms\ntdll.mak
    编译静态库：
    nmake -f ms\nt.mak
    测试动态库：
    nmake -f ms\ntdll.mak test
    测试静态库：
    nmake -f ms\nt.mak test
    安装动态库：
    nmake -f ms\ntdll.mak install
    安装静态库：
    nmake -f ms\nt.mak install
    清除上次动态库的编译，以便重新编译：
    nmake -f ms\ntdll.mak clean
    清除上次静态库的编译，以便重新编译：
    nmake -f ms\nt.mak clean

#####编译问题：
1.	mc相关错误：VC编译环境未设置，运行VCVARS32.BAT，重启机器；
2.	ml相关错误：可能masm32未安装或者未设置PATH参数；（使用no-asm方式）
3.	link相关错误：可能masm32未安装或者未设置PATH参数；
4.	in6_addr错误:遇到缺少结构定义in6_addr，把下列代码拷到apps\s_cb.c文件中#include后面即可  
	struct in6_addr   
	{  
	union  
	    {  
			u_char  Byte[16];  
			u_short Word[8];  
		} u;  
	};  
5.	ActivePerl环境未设置：修改Path参数，重启机器；
6.	动态库、静态库要分开编译，否则会出错；
7.	编译出错之后，如果要重新开始编译，请把openssl目录全部删除，再重新解压缩新文件到目录，确保编译环境正确；
8.	库函数版本问题
调整OpenSSL的静态函数库使用的库函数版本即可，调整过程如下：
编辑文件 ms\nt.mak，将该文件第19行
"CFLAG= /MD /Ox /O2 /Ob2 /W3 /WX /Gs0 /GF /Gy /nologo -DOPENSSL_SYSNAME_WIN32 -DWIN32_LEAN_AND_MEAN -DL_ENDIAN -DDSO_WIN32 -D_CRT_SECURE_NO_DEPRECATE -D_CRT_NONSTDC_NO_DEPRECATE /Fdout32 -DOPENSSL_NO_CAMELLIA -DOPENSSL_NO_SEED -DOPENSSL_NO_RC5 -DOPENSSL_NO_MDC2 -DOPENSSL_NO_TLSEXT -DOPENSSL_NO_KRB5 -DOPENSSL_NO_DYNAMIC_ENGINE"
中的"/MD"修改为"/MT"。然后重新编译安装OpenSSL即可。

####vs2008编译须知
1.	安装Perl （ActivePerl 5.10.1）;
2.	下载并解压OpenSSL包 （openssl-0.9.8l）;
3.	打开VS2008 Express的命令行，并进入OpenSSL的根目录;
4.	执行命令：perl Configure VC-WIN32 （32位机器）;
5.	执行命令：ms\do_ms.bat;
6.	执行命令：nmake -f ms\ntdll.mak （生成DLL库，在out32dll子目录中）;
7.	执行命令：nmake -f ms\nt.mak （生成静态链接库，在out32子目录中）;
注1：库文件有两个：libeay32.lib 和 ssleay32.lib
注2：头文件在“inc32”子目录中
##Log4Cpp库
###vs2003编译须知
报错error PRJ0019: 工具从"正在执行自定义生成步骤"，详细可以查看其BuildLog.htm。
将转换后的vcproj打开，需要手工修改，原来的倒数几行的如下内容，使用了错误的可执行文件路径和错误的双引号，请注意，有的人说需要把NTEventLogCategories.mc这个文件删掉，我在我的机子上验证了下，那个文件不能删，并且需要把下面的内容替换替换为后面的内容：
      <FileConfiguration Name="Debug|Win32">
        <Tool Name="VCCustomBuildTool" CommandLine="if not exist $(OutDir) md $(OutDir)
        &quot;$(DevEnvDir)..\Tools\Bin\mc.exe&quot; -h $(OutDir) -r $(OutDir) $(ProjectDir)..\$(InputName).mc
        &quot;$(DevEnvDir)..\..\vc7\Bin\RC.exe&quot; -r -fo $(OutDir)\$(InputName).res $(OutDir)\$(InputName).rc
        &quot;$(DevEnvDir)..\..\VC7\Bin\link.exe&quot; /MACHINE:IX86 -dll -noentry -out:$(OutDir)\NTEventLogAppender.dll $(OutDir)\$(InputName).res"
        Outputs="$(OutDir)\NTEventLogAppender.dll"/>
      </FileConfiguration>
      <FileConfiguration Name="Release|Win32">
        <Tool Name="VCCustomBuildTool" CommandLine="if not exist $(OutDir) md $(OutDir)
        &quot;$(DevEnvDir)..\Tools\Bin\mc.exe&quot; -h $(OutDir) -r $(OutDir) $(ProjectDir)..\$(InputName).mc
        &quot;$(DevEnvDir)..\..\vc7\Bin\RC.exe&quot; -r -fo $(OutDir)\$(InputName).res $(OutDir)\$(InputName).rc
        &quot;$(DevEnvDir)..\..\VC7\Bin\link.exe&quot; /MACHINE:IX86 -dll -noentry -out:$(OutDir)\NTEventLogAppender.dll $(OutDir)\$(InputName).res"
        Outputs="$(OutDir)\NTEventLogAppender.dll"/>
      </FileConfiguration>
替换为：
	<FileConfiguration       Name="Debug|Win32">
	     <Tool                               Name="VCCustomBuildTool"                               CommandLine="if not exist &quot;$(OutDir)&quot; md &quot;$(OutDir)&quot;&quot;$(DevEnvDir)..\..\VC98\Bin\mc.exe&quot; -h &quot;$(OutDir)&quot; -r &quot;$(OutDir)&quot; &quot;$(ProjectDir)&quot;..\&quot;$(InputName)&quot;.mc&quot;$(DevEnvDir)Bin\RC.exe&quot; -r -fo &quot;$(OutDir)&quot;\&quot;$(InputName)&quot;.res &quot;$(OutDir)&quot;\&quot;$(InputName)&quot;.rc&quot;$(DevEnvDir)..\..\VC98\Bin\link.exe&quot; /MACHINE:IX86 -dll -noentry -out:&quot;$(OutDir)&quot;\NTEventLogAppender.dll &quot;$(OutDir)&quot;\&quot;$(InputName)&quot;.res"                               Outputs="$(OutDir)\NTEventLogAppender.dll"/>             
	</FileConfiguration>  
	<FileConfiguration        Name="Release|Win32">                     
	  <Tool                               Name="VCCustomBuildTool"                               CommandLine="if not exist &quot;$(OutDir)&quot; md &quot;$(OutDir)&quot;&quot;$(DevEnvDir)..\..\VC98\Bin\mc.exe&quot; -h &quot;$(OutDir)&quot; -r &quot;$(OutDir)&quot; &quot;$(ProjectDir)&quot;..\&quot;$(InputName)&quot;.mc&quot;$(DevEnvDir)Bin\RC.exe&quot; -r -fo &quot;$(OutDir)&quot;\&quot;$(InputName)&quot;.res &quot;$(OutDir)&quot;\&quot;$(InputName)&quot;.rc&quot;$(DevEnvDir)..\..\VC98\Bin\link.exe&quot; /MACHINE:IX86 -dll -noentry -out:&quot;$(OutDir)&quot;\NTEventLogAppender.dll &quot;$(OutDir)&quot;\&quot;$(InputName)&quot;.res"                               Outputs="$(OutDir)\NTEventLogAppender.dll"/>               
	</FileConfiguration>  

#####log4cppDLL项目编译时会报8个连接错误，提示符号std::_Tree找不到
将include\log4cpp\FactoryParams.hh文件中的const_iterator find(const std::string& t) const;
修改为const_iterator find(const std::string& t) const { return storage_.find(t); }后重新编译
#####log4cppDLL项目编译时会报1个连接错误，提示符号log4cpp::localtime找不到
将src\localtime.cpp文件添加到项目中重新编译
#####log4cppDLL项目编译时找不到localtime_s找不到符号
因为VS版本低，所以头文件time.h里面没有这个函数，打开src里面的文件Localtime.cpp，
修改为localtime_s(t, time);为::tm* tmp = ::localtime(time); memcpy(t, tmp, sizeof(::tm));
编译则通过；
#####编译testPattern工程时，提示找不到localtime符号
解决方案：log4cpp项目编译时，把src\localtime.cpp文件添加到项目的Source Files中；把src\localtime.hh文件添加到项目的Header Files中重新编译；  log4cpp应用手册
1.	下载log4cpp并解压;
2.	打开\log4cpp-0.3.4b\msvc6\msvc6.dsw;
3.	编译log4cpp工程Release版;
4.	将编译后的log4cpp.lib复制到VC的Lib目录中;
5.	将头文件的目录log4cpp-0.3.4b\include\log4cpp\复制到VC的Include目录(或者添加log4cpp-0.3.4b\include到VC的Include环境变量);
6.	目标工程包含库log4cpp.lib ws2_32.lib（要选择库连接方式相同的库）。

###boost库
1)	至http://sourceforge.net/projects/boost/files/boost/1.47.0/下载boost最新版1.47.0;
2)	解压缩后，在boost根目录下运行bootstrap.bat批处理文件，得到bjam.exe;
3)	进入VS2008的Command Prompt （方法：Tools -> Visual Studio 2008 Command Prompt），转到boost目录。（例如，我的boost目录:D:\boost_1_47_0）
4)	输入“bjam --toolset=msvc-9.0 --build-type=complete stage”后，等待约30分钟，完成编译。编译成的lib文件，放在stage\lib下，形如“libboost_program_options-vc90-sgd-1_47.lib”.
PS: 编译过程与1.46.1版本的编译比较类似，1.46.1版本编译，请参考：http://blog.csdn.net/great3779/article/details/6454663

###GraphicsMagicK库
项目地址：http://sourceforge.net/projects/graphicsmagick/
最好使用：HG版本控制可实时更新(解压.hg.rar文件后使用HG的update)
####vs2008编译须知
* 打开”GraphicsMagicK\VisualMagick\configure”下的项目文件编译生成向导程序；
* 通过向导程序选择生成哪种类型的动态库；
* 执行完成后在” GraphicsMagicK\VisualMagick”目录下生成vs2009的项目文件；
* 打开此文件编译即可在”GraphicsMagicK\VisualMagick \VisualMagick\lib目录下得到所需要的库文件。
###ZXing库
项目地址：http://code.google.com/p/zxing/
####vs6编译须知
* 在ZXING的CPP源码中需求更改文件名称的（以避免冲突，我觉得也可以采用设置编译器选项来避免此问题的，

  例如通过更改相同文件生成中链接文件.obj在不同路径来避免冲突，但我没有偿试过）：
datamatrix中相同的文件（需要改名称我在文件名后加了个DM）：
detector目录:
	Detector.cpp/h      =====>> DetectorDM.cpp/h
	BitMatrixParser.cpp/h         =====>> BitMatrixParserDM.cpp/h
	DataBlock.cpp/h      =====>> DataBlockDM.cpp/h
	DecodedBitStreamParser.cpp/h  =====>> DecodedBitStreamParserDM.cpp/h
	Decoder.cpp/h      =====>> DecoderDM.cpp/h
	./:
	Version.cpp/h      =====>> VersionDM.cpp/h

* 由于ZXING的CPP源码是在LINUX下生成编译的，我们在编译时需要一些对应在WINDOWS平台下的头文件或库，
以下是我所用到的：
GnuWin32：主要用到了iconv.h头文件和libiconv.lib库，以及三个DLL，分别是libcharset1.dll，libiconv2.dll和libintl3.dll
nan.h：此文件别人传我的：-），我也没查到底从哪来的。。。

* 静态成员变量的实始化定义问题。在编译过程中可能会出现错误如下：
  error C2258: illegal pure syntax, must be '= 0'
  出现此错误的原因是由于在类中定义了静态成员变量而没有正确的进行
  初始化，例如以下代码（此代码在类定义头文件中）就会出现此问题：

  static const DecodeHintType BARCODEFORMAT_QR_CODE_HINT = 1 << BarcodeFormat_QR_CODE;
  我的解决方案是把此变量的初始化放到CPP文件中去，修改后如下：
  在头文件中定义：
  static const DecodeHintType BARCODEFORMAT_QR_CODE_HINT;
  在CPP文件中初始化：
  const DecodeHintType DecodeHints::BARCODEFORMAT_QR_CODE_HINT = 1 << BarcodeFormat_QR_CODE;

* 重载函数的显式指定类型的问题。在编译过程中可能会现错误如下：
  error C2593: 'operator =' is ambiguous
  这一般是由于有多个重载函数时，在使用时没有显式的指定所要使
  用的函数。例如，以下是出现此错误的代码：
  row = new BitArray(width_);
  修改后的代码：
  row = (Ref<BitArray>)new BitArray(width_);

* 定义枚举类型的常量问题。在编译过程中可能会出现错误如下：
  error C2057: expected constant expression
  这是由于在定义数组或枚举以及一些需要指定数值的变量时，
  其数值在预编译阶段还不能确定值的大小所引起的。例如，以
  下是出现此错误的代码：
   enum {MAX_AVG_VARIANCE = (unsigned int) (PATTERN_MATCH_RESULT_SCALE_FACTOR * 0.25f)};
   在此语句中PATTERN_MATCH_RESULT_SCALE_FACTOR的定义是：static const int PATTERN_MATCH_RESULT_SCALE_FACTOR;
   它在预编译阶段的值还没确定（因为初始化静态变量的代码放到CPP中了），因此出现此错误。
  我的临时解决办法是，在定义此枚举变量前定义一个变量，此变量值确定，从而避免此错误。
  例如：
> \#ifndef MAC_MAX_AVG_VARIANCE  
> const int MY_INTEGER_MATH_SHIFT = 8;  
> const int MY_PATTERN_MATCH_RESULT_SCALE_FACTOR = 1 << MY_INTEGER_MATH_SHIFT;  
> \#endif  
> enum {MAX_AVG_VARIANCE = (unsigned int) (MY_PATTERN_MATCH_RESULT_SCALE_FACTOR * 0.25f)};

  类似的还有如下语句：
  int patternLength = patternLen;
  int counters[patternLength];//此句会出错，因为patternLength并不确定
  我修改为通过动态创建来避免：
  int *counters = new int[patternLength];
  注意这里用完*counters要记得删除，以免造成内存泄漏。

* 要运行ZXING源码的CPP包中提供的样例（在CPP的magick文件夹下），还需要安装ImageMagick库， 我安装的是其WINDOWS下的版本ImageMagick-6.6.8-10
经过以上折腾后我的ZXING工程算是编译通过了，然后也能读取一些QR码了，其它的功能还有待挖掘。
